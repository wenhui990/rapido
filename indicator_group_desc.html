<!DOCTYPE html>
<!-- Template Name: Rapido - Responsive Admin Template build with Twitter Bootstrap 3.x Version: 1.0 Author: ClipTheme -->
<!--[if IE 8]><html class="ie8" lang="en"><![endif]-->
<!--[if IE 9]><html class="ie9" lang="en"><![endif]-->
<!--[if !IE]><!-->
<html lang="en">
	<!--<![endif]-->
	<!-- start: HEAD -->

	<head>
		<title>经济日报后台管理系统-指标分组</title>
		<!-- start: META -->
		<meta charset="utf-8" />
		<!--[if IE]><meta http-equiv='X-UA-Compatible' content="IE=edge,IE=9,IE=8,chrome=1" /><![endif]-->
		<meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=0, minimum-scale=1.0, maximum-scale=1.0">
		<meta name="apple-mobile-web-app-capable" content="yes">
		<meta name="apple-mobile-web-app-status-bar-style" content="black">
		<meta content="" name="description" />
		<meta content="" name="author" />
		<!-- end: META -->
		<!-- start: MAIN CSS -->
		<!--<link href='http://fonts.useso.com/css?family=Raleway:400,300,500,600,700,200,100,800' rel='stylesheet' type='text/css'>-->
		<link rel="stylesheet" href="assets/plugins/bootstrap/css/bootstrap.min.css">
		<link rel="stylesheet" href="assets/plugins/font-awesome/css/font-awesome.min.css">
		<link rel="stylesheet" href="assets/plugins/iCheck/skins/all.css">
		<link rel="stylesheet" href="assets/plugins/perfect-scrollbar/src/perfect-scrollbar.css">
		<link rel="stylesheet" href="assets/plugins/animate.css/animate.min.css">
		<!-- end: MAIN CSS -->
		<!-- start: CSS REQUIRED FOR SUBVIEW CONTENTS -->
		<link rel="stylesheet" href="assets/plugins/owl-carousel/owl-carousel/owl.carousel.css">
		<link rel="stylesheet" href="assets/plugins/owl-carousel/owl-carousel/owl.theme.css">
		<link rel="stylesheet" href="assets/plugins/owl-carousel/owl-carousel/owl.transitions.css">
		<link rel="stylesheet" href="assets/plugins/summernote/dist/summernote.css">
		<link rel="stylesheet" href="assets/plugins/fullcalendar/fullcalendar/fullcalendar.css">
		<link rel="stylesheet" href="assets/plugins/toastr/toastr.min.css">
		<link rel="stylesheet" href="assets/plugins/bootstrap-select/bootstrap-select.min.css">
		<link rel="stylesheet" href="assets/plugins/bootstrap-switch/dist/css/bootstrap3/bootstrap-switch.min.css">
		<link rel="stylesheet" href="assets/plugins/DataTables/media/css/DT_bootstrap.css">
		<link rel="stylesheet" href="assets/plugins/bootstrap-fileupload/bootstrap-fileupload.min.css">
		<link rel="stylesheet" href="assets/plugins/bootstrap-daterangepicker/daterangepicker-bs3.css">
		<!-- end: CSS REQUIRED FOR THIS SUBVIEW CONTENTS-->
		<!-- start: CSS REQUIRED FOR THIS PAGE ONLY -->
		<!-- end: CSS REQUIRED FOR THIS PAGE ONLY -->
		<!-- start: CORE CSS -->
		<link rel="stylesheet" href="assets/css/styles.css">
		<link rel="stylesheet" href="assets/css/styles-responsive.css">
		<link rel="stylesheet" href="assets/css/plugins.css">
		<link rel="stylesheet" href="assets/css/themes/theme-default.css" type="text/css" id="skin_color">
		<link rel="stylesheet" href="assets/css/print.css" type="text/css" media="print" />
		<!-- end: CORE CSS -->
		<link rel="shortcut icon" href="favicon.ico" />
		<link rel="stylesheet" type="text/css" href="assets/css/index.css" />

	</head>
	<!-- end: HEAD -->
	<!-- start: BODY -->

	<body>
		<div class="main-wrapper">
			<!-- start: TOPBAR -->
			<header class="topbar navbar navbar-inverse navbar-fixed-top inner">
			</header>
			<!-- end: TOPBAR -->
			<!-- start: PAGESLIDE LEFT -->
			<a class="closedbar inner hidden-sm hidden-xs" href="#">
			</a>
			<nav id="pageslide-left" class="pageslide inner">
				<div class="navbar-content">
					<!-- start: SIDEBAR -->
					<div class="main-navigation left-wrapper transition-left">
						<div class="navigation-toggler hidden-sm hidden-xs">
							<a href="#main-navbar" class="sb-toggle-left">
							</a>
						</div>
						<div class="user-profile border-top padding-horizontal-10 block">
							<div class="inline-block">
								<img src="assets/images/圆角.png" width="50" height="50" alt="">
							</div>
							<div class="inline-block">
								<h5 class="no-margin"> Welcome </h5>
								<h4 class="no-margin"> 管理员 </h4>
								<!--<a class="btn user-options sb_toggle">
									<i class="fa fa-cog"></i>
								</a>-->
							</div>
						</div>
						<!-- start: MAIN NAVIGATION MENU -->
						<ul class="main-navigation-menu">

						</ul>
						<!-- end: MAIN NAVIGATION MENU -->
					</div>
					<!-- end: SIDEBAR -->
				</div>
				<div class="slide-tools">
					<div class="col-xs-6 text-left no-padding">
						<!--<a class="btn btn-sm status" href="#">
							Status <i class="fa fa-dot-circle-o text-green"></i> <span>Online</span>
						</a>-->
					</div>
					<div class="col-xs-6 text-right no-padding">
						<a class="btn btn-sm log-out text-right" href="#">
							<i class="fa fa-power-off"></i> Log Out
						</a>
					</div>
				</div>
			</nav>
			<!-- end: PAGESLIDE LEFT -->
			<!-- start: MAIN CONTAINER -->
			<div class="main-container inner">
				<!-- start: PAGE -->
				<div class="main-content">
					<div class="container" style="height: 20px;">
						
					</div>
					<div class="container">
						<div class="row">
							<div class="col-sm-12">
								<div class="tabbable">
									<div id="add_indicator_group">
										<a href="#" class="btn btn-default btn-sm" data-toggle="modal" data-target="#myAddModal" id="add_indicator_list" title="添加指标"><!--<span class="glyphicon glyphicon-plus"></span>-->添加指标</a>
									</div>
									<ul class="nav nav-tabs tab-padding tab-space-3 tab-blue" id="myTab4">
										<li class="active">
											<a data-toggle="tab" href="#panel_overview">
												指标详细列表
											</a>
										</li>
									</ul>
									<div class="tab-content">
										<div id="panel_overview" class="tab-pane fade in active">
											<table class="table table-striped table-bordered table-hover" id="projects">
												<thead>
													<tr>
														<th class="center">id</th>
														<th>中文名</th>
														<th>指标名</th>
														<th class="hidden-xs">英文名</th>
														<th class="hidden-xs">父指标</th>
														<th>操作</th>
													</tr>
												</thead>
												<tbody id="indicator_datas_descp">
												</tbody>
											</table>
											<div id="loading"><img src="assets/images/loading.gif"/>正在加载中...</div>
										</div>
									</div>
								</div>
							</div>
						</div>
					</div>
					<!--<div class="container" id="pages">
						<div class="row">
							<nav aria-label="...">
							  <ul class="pager">
							    <li><a href="javascript:;" id="prvePage">上一页</a></li>
							    <li>
							    	跳到
							    	<input type="text" placeholder="输入页数" style="width: 66px;" id="pageVal" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" />页
							    	<button id="pageOk">确定</button>
							    </li>
							    <li><a href="javascript:;" id="nextPage">下一页</a></li>
							  </ul>
							</nav>
						</div>	
					</div>-->
				</div>
				<!-- end: PAGE -->
			</div>

			<!-- 删除分组弹出模版 -->
			<div class="modal fade" id="myDelModal" tabindex="-1" role="dialog">
				<div class="modal-dialog" role="document">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							<h4 class="modal-title">删除</h4>
						</div>
						<div class="modal-body">
							确定删除吗？
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
							<button type="button" data-dismiss="modal" class="btn btn-success del_btn">确定</button>
						</div>
					</div>
				</div>
			</div>
			<!-- 新增分组弹出模版 -->
			<div class="modal" id="myAddModal" tabindex="-1" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true" data-backdrop="static">
				<div class="modal-dialog" role="document" style="width: 90%;">
					<div class="modal-content">
						<div class="modal-header">
							<button type="button" class="close close_ref" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
							<h4 class="modal-title">添加指标分组</h4>
							<div id="sousuo">
								数据源：
								<select name="" id="sjy">
									<option value="请选择">请选择</option>
									<option value="101" selected="selected">全球</option>
									<option value="100">中国</option>
								</select>
								<input type="text" name="sousuotxt" id="sousuotxt" value="" placeholder="请输入搜索内容" />
							</div>
						</div>
						<div class="modal-body">
							<div id="all_indicator"></div>
							<div class="container" id="pages1">
								<div class="row">
									<nav aria-label="...">
										<ul class="pager">
											<li>
												<a href="javascript:;" id="prvePage1">上一页</a>
											</li>
											<li>
												跳到
												<input type="text" placeholder="输入页数" style="width: 66px;" id="pageVal1" onkeyup="this.value=this.value.replace(/\D/g,'')" onafterpaste="this.value=this.value.replace(/\D/g,'')" />页
												<button id="pageOk1">确定</button>
											</li>
											<li>
												<a href="javascript:;" id="nextPage1">下一页</a>
											</li>
										</ul>
									</nav>
								</div>
							</div>
						</div>
						<div class="modal-footer">
							<button type="button" class="btn btn-default close_ref" data-dismiss="modal">关闭</button>
						</div>
					</div>
				</div>
			</div>

			<!-- end: MAIN CONTAINER -->
			<!-- start: FOOTER -->
			<footer class="inner">
			</footer>
			<!-- end: FOOTER -->
			<!-- start: SUBVIEW SAMPLE CONTENTS -->

		</div>
		<!-- start: MAIN JAVASCRIPTS -->
		<!--[if lt IE 9]>
		<script src="assets/plugins/respond.min.js"></script>
		<script src="assets/plugins/excanvas.min.js"></script>
		<script type="text/javascript" src="assets/plugins/jQuery/jquery-1.11.1.min.js"></script>
		<![endif]-->
		<!--[if gte IE 9]><!-->
		<script src="assets/plugins/jQuery/jquery-2.1.1.min.js"></script>
		<!--<![endif]-->
		<script type="text/javascript">
			$(".main-navigation-menu").load("left_nav.html");
		</script>
		<script src="assets/plugins/jquery-ui/jquery-ui-1.10.2.custom.min.js"></script>
		<script src="assets/plugins/bootstrap/js/bootstrap.min.js"></script>
		<script src="assets/plugins/blockUI/jquery.blockUI.js"></script>
		<script src="assets/plugins/iCheck/jquery.icheck.min.js"></script>
		<script src="assets/plugins/moment/min/moment.min.js"></script>
		<script src="assets/plugins/perfect-scrollbar/src/jquery.mousewheel.js"></script>
		<script src="assets/plugins/perfect-scrollbar/src/perfect-scrollbar.js"></script>
		<script src="assets/plugins/bootbox/bootbox.min.js"></script>
		<script src="assets/plugins/jquery.scrollTo/jquery.scrollTo.min.js"></script>
		<script src="assets/plugins/ScrollToFixed/jquery-scrolltofixed-min.js"></script>
		<script src="assets/plugins/jquery.appear/jquery.appear.js"></script>
		<script src="assets/plugins/jquery-cookie/jquery.cookie.js"></script>
		<script src="assets/plugins/velocity/jquery.velocity.min.js"></script>
		<script src="assets/plugins/TouchSwipe/jquery.touchSwipe.min.js"></script>
		<!-- end: MAIN JAVASCRIPTS -->
		<!-- start: JAVASCRIPTS REQUIRED FOR SUBVIEW CONTENTS -->
		<!--<script src="assets/plugins/owl-carousel/owl-carousel/owl.carousel.js"></script>
		<script src="assets/plugins/jquery-mockjax/jquery.mockjax.js"></script>
		<script src="assets/plugins/toastr/toastr.js"></script>
		<script src="assets/plugins/bootstrap-modal/js/bootstrap-modal.js"></script>
		<script src="assets/plugins/bootstrap-modal/js/bootstrap-modalmanager.js"></script>
		<script src="assets/plugins/fullcalendar/fullcalendar/fullcalendar.min.js"></script>
		<script src="assets/plugins/bootstrap-switch/dist/js/bootstrap-switch.min.js"></script>
		<script src="assets/plugins/bootstrap-select/bootstrap-select.min.js"></script>
		<script src="assets/plugins/jquery-validation/dist/jquery.validate.min.js"></script>
		<script src="assets/plugins/bootstrap-fileupload/bootstrap-fileupload.min.js"></script>
		<script src="assets/plugins/DataTables/media/js/jquery.dataTables.min.js"></script>
		<script src="assets/plugins/DataTables/media/js/DT_bootstrap.js"></script>
		<script src="assets/plugins/truncate/jquery.truncate.js"></script>
		<script src="assets/plugins/summernote/dist/summernote.min.js"></script>
		<script src="assets/plugins/bootstrap-daterangepicker/daterangepicker.js"></script>
		<script src="assets/js/subview.js"></script>
		<script src="assets/js/subview-examples.js"></script>-->
		<!-- end: JAVASCRIPTS REQUIRED FOR SUBVIEW CONTENTS -->
		<!-- start: JAVASCRIPTS REQUIRED FOR THIS PAGE ONLY -->
		<script src="assets/plugins/bootstrap-paginator/src/bootstrap-paginator.js"></script>
		<script src="assets/plugins/bootstrap-progressbar/bootstrap-progressbar.min.js"></script>
		<script src="assets/plugins/jquery.pulsate/jquery.pulsate.min.js"></script>
		<script src="assets/plugins/holder/holder.js"></script>
		<script src="assets/js/ui-elements.js"></script>
		<!-- end: JAVASCRIPTS REQUIRED FOR THIS PAGE ONLY -->
		<!-- start: CORE JAVASCRIPTS  -->
		<script src="assets/js/main.js"></script>
		<!-- end: CORE JAVASCRIPTS  -->
		<script src="assets/js/public.js" type="text/javascript" charset="utf-8"></script>
		<script>
			jQuery(document).ready(function() {
				Main.init();
				//				SVExamples.init();
				UIElements.init();

				var id = getUrlParams().id;

				// 加载分组详细信息
				indicatorGroupDescp(n);

				function indicatorGroupDescp() {
					$.ajax({
						type: "get",
						url: _href + interfacelist.group + id, //"http://api.jjrb.grsx.cc/data/group/20",
						async: true,
						success: function(data) {
							$('#loading').hide();
							if(data.indicators) {
								$.each(data.indicators, function(i, e) {
									var name_en,name_zh;
									e.name_en===null?name_en='':name_en=e.name_en;
									e.name_zh===null?name_zh='':name_zh=e.name_zh;
									var html = '<tr><td class="center">' + e.pid + '</td>' +
										'<td>' + name_zh + '</td>' +
										'<td>' + e.id + '</td>' +
										'<td class="hidden-xs">' + name_en + '</td>' +
										'<td class="hidden-xs">' + data.id + "：" + data.name + '</td>' +
										'<td class="hidden-xs"><a href="#myDelModal" class="del_indicator_group" data-toggle="modal" data-target="#myDelModal" data-parent-id = "'+data.id+'" data-id="'+e.pid+'" title="删除分组指标"><span class="glyphicon glyphicon-remove-sign"></span></a></td></tr>';
									$('#indicator_datas_descp').prepend(html);
								});
							}
						},
						error: function(err) {
							console.log(err);
						}
					});
				}

				// 获取全部指标-添加指标
//				$(document).on('click', '#add_indicator_list', function() {
//					n = 1;
//					allIndicator(n);
//				});

				function allIndicator(n) {
					$.ajax({
						type: "get",
						url: _href + interfacelist.indicator,
						async: true,
						data: {
							page: n,
							limit: 200,
							token: localStorage.token
						},
						success: function(data) {
							$.each(data, function(i, e) {
								var html = '<a href="javascript:void(0);" class="btn btn-default addToIndi" title="' + e.id + '" data-id="' + e.pid + '">' + e.name_zh + '</a>';
								$("#all_indicator").append(html);
							});
						}
					});
				}

				// 点击指标添加到分组里
				$(document).on('click', '.addToIndi', function() {
					var groupId = getUrlParams().id;
					groupId = parseInt(groupId);
					$.ajax({
						type: "post",
						url: _href + '/data2/group/' + groupId + '/indicator',
						async: true,
						data: {
							token: localStorage.token,
							indicator_id: $(this).attr('data-id'),
						},
						success: function(data) {
							$('#dialogPulic').find('.modal-body').text('添加成功！');
							$('#dialogPulic').modal('show');
						}
					});
				});
				
				// 点击关闭后刷新页面
				$(".close_ref").click(function(){
					window.location.reload();
				});

				// 点击上一页下一页
				$(document).on("click", "#prvePage,#nextPage", function() {
					$('#loading').show();
					$("#projects").find("tbody").html('');
					var cv = $(this).attr("id");
					cv === 'prvePage' ? n-- : n++;
					if(n < 1) n = 1;
					indicatorGroupDescp(n);
					allIndicator(n);
				});
				// 点击确定跳转页面
				$(document).on("click", "#pageOk", function() {
					$('#loading').show();
					$("#projects").find("tbody").html('');
					var pageVal = $("#pageVal").val();
					if(pageVal.length < 0) {
						alert("");
						$('#dialogPulic').find('.modal-body').text('请输入要跳到的页数！');
						$('#dialogPulic').modal('show');
						$("#pageVal").focus();
					}
					if(pageVal < 1) {
						$("#pageVal").val(1);
					}
					indicatorGroupDescp(pageVal);
					allIndicator(pageVal);
					n = pageVal;
				});

				// 点击添加里的上一页下一页
				$(document).on("click", "#prvePage1,#nextPage1", function() {
					$("#all_indicator").html('');
					var cv = $(this).attr("id");
					cv === 'prvePage' ? n-- : n++;
					if(n < 1) n = 1;
					allIndicator(n);
				});
				// 点击添加里的确定跳转页面
				$(document).on("click", "#pageOk1", function() {
					$("#all_indicator").html('');
					var pageVal = $("#pageVal").val();
					if(pageVal.length < 0) {
						$('#dialogPulic').find('.modal-body').text('请输入要跳到的页数！');
						$('#dialogPulic').modal('show');
						$("#pageVal").focus();
					}
					if(pageVal < 1) {
						$("#pageVal").val(1);
					}
					allIndicator(pageVal);
					n = pageVal;
				});

				var lasttime;
				// 搜索指标
				$(document).on('keyup', '#sousuotxt', function(e) {
					lasttime = e.timeStamp;
					var _val = $(this).val();
					var source = $('#sjy').val();
					var _src = _href + '/data2/indicator/k/' + _val;
					isNaN(source) ? _src = _src : _src += '?source=' + source;
					setTimeout(function(){
						if(lasttime-e.timeStamp==0){
							$.ajax({
								type: "get",
								url: _src,
								data:{
									limit:1000
								},
								success: function(data) {
									$("#all_indicator").html('');
									var d = data;
									//							console.log(d);
									$(d).each(function(i, e) {
										//								console.log(e);
										var _name, _id;
										_id = e.id;
										_name = e.name_zh;
										var html = '<a href="javascript:void(0);" class="btn btn-default addToIndi" title="' + _id + '" data-id="' + e.pid + '">' + _name + '</a>';
										$("#all_indicator").append(html);
									});
								},
								error: function(data) {
									console.log(data.error().status);
								}
							});
						}
					},500);
					
				});
				
				// 删除指标
				$(document).on('click','.del_indicator_group',function(){
					var _pid = $(this).attr('data-parent-id');
					var _id = $(this).attr('data-id');
					$(this).parents('tr').remove();
					$('.del_btn').click(function(){
						$.ajax({
							type:"delete",
							url: _href + '/data2/group/'+_pid+'/indicator?token='+localStorage.token+'&indicator_id='+_id,
//							data:{
//								token : localStorage.token,
//								indicator_id: _id
//							},
							success: function(data){
								if(data.msg==='success'){
									$('#dialogPulic').find('.modal-body').text('删除成功！');
									$('#dialogPulic').modal('show');
								}
							}
						});
					});
					
				});
			});
		</script>
	</body>
	<!-- end: BODY -->

</html>